import {useState,useRef,useEffect,useCallback}from'react';function O(e,t=""){let r=new FormData;function o(n,i){if(n==null){r.append(i,"");return}if(n instanceof File||n instanceof Blob){r.append(i,n);return}if(Array.isArray(n)){n.forEach((s,c)=>{o(s,`${i}[${c}]`);});return}if(typeof n=="object"&&n.constructor===Object){Object.keys(n).forEach(s=>{let c=n[s],u=i?`${i}.${s}`:s;o(c,u);});return}n instanceof Date?r.append(i,n.toISOString()):r.append(i,String(n));}return Object.keys(e).forEach(n=>{let i=t?`${t}.${n}`:n;o(e[n],i);}),r}function E(e){let t={};return e.forEach((r,o)=>{$(t,o,r);}),t}function $(e,t,r){let o=t.split(/[.\[\]]/).filter(Boolean),n=e;for(let c=0;c<o.length-1;c++){let u=o[c],l=o[c+1],g=!isNaN(Number(l));u in n||(n[u]=g?[]:{}),n=n[u];}let i=o[o.length-1],s=r;typeof r=="string"&&(r.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)?s=new Date(r):!isNaN(Number(r))&&r!==""?s=Number(r):r==="true"||r==="false"?s=r==="true":r===""&&(s=null)),n[i]=s;}function j(e){if(e==null)return e;if(Array.isArray(e))return e.map(j);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,o]of Object.entries(e))t[r]=j(o);return t}}return e}function q(e){return async t=>{try{let r=E(t),o=await e(r);return {ok:!0,message:"Operation completed successfully",data:j(o)}}catch(r){return {ok:false,message:r instanceof Error?r.message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}}}var w=async(e,t)=>{try{let r;return t instanceof FormData?r=t:r=O(t),await e(r)}catch(r){return {ok:false,message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}};function F(e){if(e==null)return e;if(Array.isArray(e))return e.map(F);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,o]of Object.entries(e))t[r]=F(o);return t}}return e}function C(e,t="Operation successful"){return {ok:true,message:t,data:F(e)}}function L(e,t="Operation failed"){return {ok:false,message:t,error:e instanceof Error?e:new Error(String(e))}}function V({action:e,condition:t,cacheTime:r=0,revalidateOnMount:o=true,revalidateOnFocus:n=false,dedupingInterval:i=2e3,executeOnMount:s=true,onSuccess:c,onError:u}){let[l,g]=useState(false),[K,S]=useState(),[U,y]=useState(),v=useRef(false),A=useRef(void 0),p=useRef(null),k=useRef(0),a=useRef(null);useEffect(()=>()=>{p.current&&p.current.abort(),a.current&&clearTimeout(a.current);},[]);let T=useCallback(async f=>{if(typeof t<"u"&&!t)return;f&&(A.current=f);let x=Date.now();if(x-k.current<i&&l)return;k.current=x,p.current&&p.current.abort(),p.current=new AbortController;let z=p.current.signal;g(true),S(void 0);try{let m=await w(e,f||A.current||{});if(z.aborted)return;if(m.ok)y(m.data),c&&c(m.data),r>0&&(a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{y(void 0);},r));else {let d=m.message||"Operation failed";S(d),u&&u(d);}return m}catch(m){if(!z.aborted){let d=m.message||"An unexpected error occurred";S(d),u&&u(d);}}finally{z.aborted||g(false);}},[t,e,l,r,i,c,u]),D=useCallback(async()=>await T(A.current),[T]),B=useCallback(()=>{y(void 0),S(void 0),A.current=void 0,p.current&&p.current.abort(),a.current&&clearTimeout(a.current);},[]),P=useCallback(f=>{y(f),a.current&&(clearTimeout(a.current),a.current=null);},[]),_=useCallback(f=>{y(x=>f(x));},[]);return useEffect(()=>{if(!n)return;let f=()=>{document.visibilityState==="visible"&&D();};return document.addEventListener("visibilitychange",f),window.addEventListener("focus",f),()=>{document.removeEventListener("visibilitychange",f),window.removeEventListener("focus",f);}},[n,D]),useEffect(()=>{v.current||(v.current=true,s&&(o&&typeof t>"u"||t)&&T());},[s,o,t,T]),{data:U,error:K,loading:l,execute:T,refetch:D,mutate:P,optimisticMutate:_,reset:B}}export{L as createErrorResponse,C as createSuccessResponse,E as formDataToObject,O as objectToFormData,F as sanitizeForTransport,w as serverActionRequest,V as useSAR,q as withFormTransform};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map