import {useState,useRef,useEffect,useCallback}from'react';function w(e,t=""){let r=new FormData;function s(o,n){if(o==null){r.append(n,"");return}if(o instanceof File||o instanceof Blob){r.append(n,o);return}if(Array.isArray(o)){o.forEach((i,a)=>{s(i,`${n}[${a}]`);});return}if(typeof o=="object"&&o.constructor===Object){Object.keys(o).forEach(i=>{let a=o[i],u=n?`${n}.${i}`:i;s(a,u);});return}o instanceof Date?r.append(n,o.toISOString()):r.append(n,String(o));}return Object.keys(e).forEach(o=>{let n=t?`${t}.${o}`:o;s(e[o],n);}),r}function E(e){let t={};return e.forEach((r,s)=>{q(t,s,r);}),t}function q(e,t,r){let s=t.split(/[.\[\]]/).filter(Boolean),o=e;for(let a=0;a<s.length-1;a++){let u=s[a],m=s[a+1],d=!isNaN(Number(m));u in o||(o[u]=d?[]:{}),o=o[u];}let n=s[s.length-1],i=r;typeof r=="string"&&(r.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)?i=new Date(r):!isNaN(Number(r))&&r!==""?i=Number(r):r==="true"||r==="false"?i=r==="true":r===""&&(i=null)),o[n]=i;}function R(e){if(e==null)return e;if(Array.isArray(e))return e.map(R);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,s]of Object.entries(e))t[r]=R(s);return t}}return e}function C(e){return async t=>{try{let r=E(t),s=await e(r);if(s&&typeof s=="object"&&!Array.isArray(s)){let n=s;if(typeof n.ok=="boolean"){if(n.ok)return {ok:!0,message:n.message||"Operation completed successfully",data:R(n.data)};throw n.error||new Error(n.message||"Operation failed")}if("data"in n&&!("error"in n))return {ok:!0,message:n.message||"Operation completed successfully",data:R(n.data)};if("error"in n&&!("data"in n))throw n.error instanceof Error?n.error:new Error(n.message||"Operation failed")}return {ok:!0,message:"Operation completed successfully",data:R(s)}}catch(r){return {ok:false,message:r instanceof Error?r.message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}}}var j=async(e,t)=>{try{let r;return t instanceof FormData?r=t:r=w(t),await e(r)}catch(r){return {ok:false,message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}};function D(e){if(e==null)return e;if(Array.isArray(e))return e.map(D);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,s]of Object.entries(e))t[r]=D(s);return t}}return e}function L(e,t="Operation successful"){return {ok:true,message:t,data:D(e)}}function V(e,t="Operation failed"){return {ok:false,message:t,error:e instanceof Error?e:new Error(String(e))}}function I({action:e,condition:t,cacheTime:r=0,revalidateOnMount:s=true,revalidateOnFocus:o=false,dedupingInterval:n=2e3,executeOnMount:i=true,initialExecuteData:a,onSuccess:u,onError:m}){let[d,N]=useState(false),[U,A]=useState(),[B,y]=useState(),v=useRef(false),x=useRef(void 0),p=useRef(null),K=useRef(0),f=useRef(null);useEffect(()=>()=>{p.current&&p.current.abort(),f.current&&clearTimeout(f.current);},[]);let T=useCallback(async c=>{if(typeof t<"u"&&!t)return;c&&(x.current=c);let F=Date.now();if(F-K.current<n&&d)return;K.current=F,p.current&&p.current.abort(),p.current=new AbortController;let O=p.current.signal;N(true),A(void 0);try{let l=await j(e,c||x.current||{});if(O.aborted)return;if(l.ok)y(l.data),u&&u(l.data),r>0&&(f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{y(void 0);},r));else {let b=l.message||"Operation failed";A(b),m&&m(b);}return l}catch(l){if(!O.aborted){let b=l.message||"An unexpected error occurred";A(b),m&&m(b);}}finally{O.aborted||N(false);}},[t,e,d,r,n,u,m]),z=useCallback(async()=>await T(x.current),[T]),P=useCallback(()=>{y(void 0),A(void 0),x.current=void 0,p.current&&p.current.abort(),f.current&&clearTimeout(f.current);},[]),_=useCallback(c=>{y(c),f.current&&(clearTimeout(f.current),f.current=null);},[]),$=useCallback(c=>{y(F=>c(F));},[]);return useEffect(()=>{if(!o)return;let c=()=>{document.visibilityState==="visible"&&z();};return document.addEventListener("visibilitychange",c),window.addEventListener("focus",c),()=>{document.removeEventListener("visibilitychange",c),window.removeEventListener("focus",c);}},[o,z]),useEffect(()=>{v.current||(v.current=true,i&&(s&&typeof t>"u"||t)&&T(a));},[i,s,t,T,a]),{data:B,error:U,loading:d,execute:T,refetch:z,mutate:_,optimisticMutate:$,reset:P}}export{V as createErrorResponse,L as createSuccessResponse,E as formDataToObject,w as objectToFormData,D as sanitizeForTransport,j as serverActionRequest,I as useSAR,C as withFormTransform};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map