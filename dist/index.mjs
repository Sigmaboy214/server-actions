import {useState,useRef,useEffect,useCallback}from'react';function O(e,t=""){let r=new FormData;function o(n,i){if(n==null){r.append(i,"");return}if(n instanceof File||n instanceof Blob){r.append(i,n);return}if(Array.isArray(n)){n.forEach((s,f)=>{o(s,`${i}[${f}]`);});return}if(typeof n=="object"&&n.constructor===Object){Object.keys(n).forEach(s=>{let f=n[s],a=i?`${i}.${s}`:s;o(f,a);});return}n instanceof Date?r.append(i,n.toISOString()):r.append(i,String(n));}return Object.keys(e).forEach(n=>{let i=t?`${t}.${n}`:n;o(e[n],i);}),r}function j(e){let t={};return e.forEach((r,o)=>{q(t,o,r);}),t}function q(e,t,r){let o=t.split(/[.\[\]]/).filter(Boolean),n=e;for(let f=0;f<o.length-1;f++){let a=o[f],m=o[f+1],y=!isNaN(Number(m));a in n||(n[a]=y?[]:{}),n=n[a];}let i=o[o.length-1],s=r;typeof r=="string"&&(r.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)?s=new Date(r):!isNaN(Number(r))&&r!==""?s=Number(r):r==="true"||r==="false"?s=r==="true":r===""&&(s=null)),n[i]=s;}function E(e){if(e==null)return e;if(Array.isArray(e))return e.map(E);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,o]of Object.entries(e))t[r]=E(o);return t}}return e}function C(e){return async t=>{try{let r=j(t),o=await e(r);return {ok:!0,message:"Operation completed successfully",data:E(o)}}catch(r){return {ok:false,message:r instanceof Error?r.message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}}}var w=async(e,t)=>{try{let r;return t instanceof FormData?r=t:r=O(t),await e(r)}catch(r){return {ok:false,message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}};function F(e){if(e==null)return e;if(Array.isArray(e))return e.map(F);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,o]of Object.entries(e))t[r]=F(o);return t}}return e}function L(e,t="Operation successful"){return {ok:true,message:t,data:F(e)}}function V(e,t="Operation failed"){return {ok:false,message:t,error:e instanceof Error?e:new Error(String(e))}}function I({action:e,condition:t,cacheTime:r=0,revalidateOnMount:o=true,revalidateOnFocus:n=false,dedupingInterval:i=2e3,executeOnMount:s=true,initialExecuteData:f,onSuccess:a,onError:m}){let[y,v]=useState(false),[U,S]=useState(),[B,T]=useState(),k=useRef(false),A=useRef(void 0),p=useRef(null),K=useRef(0),u=useRef(null);useEffect(()=>()=>{p.current&&p.current.abort(),u.current&&clearTimeout(u.current);},[]);let d=useCallback(async c=>{if(typeof t<"u"&&!t)return;c&&(A.current=c);let x=Date.now();if(x-K.current<i&&y)return;K.current=x,p.current&&p.current.abort(),p.current=new AbortController;let z=p.current.signal;v(true),S(void 0);try{let l=await w(e,c||A.current||{});if(z.aborted)return;if(l.ok)T(l.data),a&&a(l.data),r>0&&(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{T(void 0);},r));else {let b=l.message||"Operation failed";S(b),m&&m(b);}return l}catch(l){if(!z.aborted){let b=l.message||"An unexpected error occurred";S(b),m&&m(b);}}finally{z.aborted||v(false);}},[t,e,y,r,i,a,m]),D=useCallback(async()=>await d(A.current),[d]),P=useCallback(()=>{T(void 0),S(void 0),A.current=void 0,p.current&&p.current.abort(),u.current&&clearTimeout(u.current);},[]),_=useCallback(c=>{T(c),u.current&&(clearTimeout(u.current),u.current=null);},[]),$=useCallback(c=>{T(x=>c(x));},[]);return useEffect(()=>{if(!n)return;let c=()=>{document.visibilityState==="visible"&&D();};return document.addEventListener("visibilitychange",c),window.addEventListener("focus",c),()=>{document.removeEventListener("visibilitychange",c),window.removeEventListener("focus",c);}},[n,D]),useEffect(()=>{k.current||(k.current=true,s&&(o&&typeof t>"u"||t)&&d(f));},[s,o,t,d,f]),{data:B,error:U,loading:y,execute:d,refetch:D,mutate:_,optimisticMutate:$,reset:P}}export{V as createErrorResponse,L as createSuccessResponse,j as formDataToObject,O as objectToFormData,F as sanitizeForTransport,w as serverActionRequest,I as useSAR,C as withFormTransform};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map