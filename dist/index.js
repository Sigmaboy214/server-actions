'use strict';var react=require('react');function O(e,t=""){let r=new FormData;function s(o,n){if(o==null){r.append(n,"");return}if(o instanceof File||o instanceof Blob){r.append(n,o);return}if(Array.isArray(o)){o.forEach((i,c)=>{s(i,`${n}[${c}]`);});return}if(typeof o=="object"&&o.constructor===Object){Object.keys(o).forEach(i=>{let c=o[i],u=n?`${n}.${i}`:i;s(c,u);});return}o instanceof Date?r.append(n,o.toISOString()):r.append(n,String(o));}return Object.keys(e).forEach(o=>{let n=t?`${t}.${o}`:o;s(e[o],n);}),r}function w(e){let t={};return e.forEach((r,s)=>{q(t,s,r);}),t}function q(e,t,r){let s=t.split(/[.\[\]]/).filter(Boolean),o=e;for(let c=0;c<s.length-1;c++){let u=s[c],m=s[c+1],y=!isNaN(Number(m));u in o||(o[u]=y?[]:{}),o=o[u];}let n=s[s.length-1],i=r;typeof r=="string"&&(r.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)?i=new Date(r):!isNaN(Number(r))&&r!==""?i=Number(r):r==="true"||r==="false"?i=r==="true":r===""&&(i=null)),o[n]=i;}function g(e){if(e==null)return e;if(Array.isArray(e))return e.map(g);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,s]of Object.entries(e))t[r]=g(s);return t}}return e}function C(e){return async t=>{try{let r=w(t),s=await e(r);if(s&&typeof s=="object"&&!Array.isArray(s)){let n=s;if(typeof n.ok=="boolean"){if(n.ok)return {ok:!0,message:n.message||"Operation completed successfully",data:g(n.data)};throw n.error||new Error(n.message||"Operation failed")}if("data"in n&&!("error"in n))return {ok:!0,message:n.message||"Operation completed successfully",data:g(n.data)};if("error"in n&&!("data"in n))throw n.error instanceof Error?n.error:new Error(n.message||"Operation failed")}return {ok:!0,message:"Operation completed successfully",data:g(s)}}catch(r){return {ok:false,message:r instanceof Error?r.message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}}}var h=async(e,t)=>{try{let r;return t instanceof FormData?r=t:r=O(t),await e(r)}catch(r){return {ok:false,message:"Error processing request",error:r instanceof Error?r:new Error(String(r))}}};function F(e){if(e==null)return e;if(Array.isArray(e))return e.map(F);if(typeof e=="object"){if(e instanceof Date)return e.toISOString();if(e instanceof File||e instanceof Blob)return {name:e instanceof File?e.name:"blob",size:e.size,type:e.type,_isFile:true};if(e.constructor===Object){let t={};for(let[r,s]of Object.entries(e))t[r]=F(s);return t}}return e}function L(e,t="Operation successful"){return {ok:true,message:t,data:F(e)}}function V(e,t="Operation failed"){return {ok:false,message:t,error:e instanceof Error?e:new Error(String(e))}}function W({action:e,condition:t,cacheTime:r=0,revalidateOnMount:s=true,revalidateOnFocus:o=false,dedupingInterval:n=2e3,executeOnMount:i=true,initialExecuteData:c,onSuccess:u,onError:m}){let[y,v]=react.useState(false),[P,D]=react.useState(),[U,d]=react.useState(),N=react.useRef(false),x=react.useRef(void 0),p=react.useRef(null),K=react.useRef(0),f=react.useRef(null);react.useEffect(()=>()=>{p.current&&p.current.abort(),f.current&&clearTimeout(f.current);},[]);let T=react.useCallback(async a=>{if(typeof t<"u"&&!t)return;a&&(x.current=a);let A=Date.now();if(A-K.current<n&&y)return;K.current=A,p.current&&p.current.abort(),p.current=new AbortController;let z=p.current.signal;v(true),D(void 0);try{let l=await h(e,a||x.current||{});if(z.aborted)return;if(l.ok)d(l.data),u&&u(l.data),r>0&&(f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{d(void 0);},r));else {let R=l.message||"Operation failed";D(R),m&&m(R);}return l}catch(l){if(!z.aborted){let R=l.message||"An unexpected error occurred";D(R),m&&m(R);}}finally{z.aborted||v(false);}},[t,e,y,r,n,u,m]),E=react.useCallback(async()=>await T(x.current),[T]),B=react.useCallback(()=>{d(void 0),D(void 0),x.current=void 0,p.current&&p.current.abort(),f.current&&clearTimeout(f.current);},[]),_=react.useCallback(a=>{d(a),f.current&&(clearTimeout(f.current),f.current=null);},[]),$=react.useCallback(a=>{d(A=>a(A));},[]);return react.useEffect(()=>{if(!o)return;let a=()=>{document.visibilityState==="visible"&&E();};return document.addEventListener("visibilitychange",a),window.addEventListener("focus",a),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("focus",a);}},[o,E]),react.useEffect(()=>{N.current||(N.current=true,i&&(s&&typeof t>"u"||t)&&T(c));},[i,s,t,T,c]),{data:U,error:P,loading:y,execute:T,refetch:E,mutate:_,optimisticMutate:$,reset:B}}exports.createErrorResponse=V;exports.createSuccessResponse=L;exports.formDataToObject=w;exports.objectToFormData=O;exports.sanitizeForTransport=F;exports.serverActionRequest=h;exports.useSAR=W;exports.withFormTransform=C;//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map